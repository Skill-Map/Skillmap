<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учебные материалы - Skillmap Teacher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Подключаем редактор текста -->
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
    <style>
        :root {
            --color-primary: #1A535C;
            --color-secondary: #F2C14E;
            --color-teacher: #0EA5E9;
        }
        .teacher-bg { background-color: var(--color-teacher); }
        .teacher-text { color: var(--color-teacher); }
        .teacher-border { border-color: var(--color-teacher); }
        .material-card { transition: all 0.3s ease; }
        .material-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .material-type-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .material-type-article { background-color: #DBEAFE; color: #1E40AF; }
        .material-type-video { background-color: #FEE2E2; color: #991B1B; }
        .material-type-presentation { background-color: #FEF3C7; color: #92400E; }
        .material-type-exercise { background-color: #D1FAE5; color: #065F46; }
        .material-type-cheatsheet { background-color: #E0E7FF; color: #3730A3; }
        .ql-editor { min-height: 200px; }
        .drag-handle { cursor: move; }
        .sortable-ghost { opacity: 0.4; }
        [x-cloak] { display: none !important; }
    </style>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
</head>
<body class="antialiased bg-gray-50" x-data="materialsPage()" x-init="init()">
    <!-- Шапка -->
    <header class="bg-white shadow-sm border-b">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="dashboard.html" class="flex items-center space-x-3">
                        <div class="teacher-bg p-2 rounded-lg">
                            <img src="../images/logo.png" alt="Skillmap Logo" class="h-6 w-6">
                        </div>
                        <span class="text-xl font-bold teacher-text">Skillmap Teacher</span>
                    </a>
                    <nav class="ml-10 flex space-x-6">
                        <a href="dashboard.html" class="text-gray-600 hover:teacher-text">Дашборд</a>
                        <a href="students.html" class="text-gray-600 hover:teacher-text">Студенты</a>
                        <a href="materials.html" class="teacher-text font-semibold">Материалы</a>
                        <a href="#" class="text-gray-600 hover:teacher-text">Задания</a>
                        <a href="#" class="text-gray-600 hover:teacher-text">Аналитика</a>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-700" x-text="user.name"></span>
                    <button @click="logout()" class="px-4 py-2 text-sm font-semibold rounded-lg teacher-text border teacher-border hover:teacher-bg hover:text-white transition">
                        Выйти
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Заголовок и статистика -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Учебные материалы</h1>
                        <p class="text-gray-600 mt-2">Создание и управление учебными материалами для студентов</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button @click="showCreateModal = true" 
                                class="px-4 py-2 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                            <i class="fas fa-plus mr-2"></i>Создать материал
                        </button>
                        <button @click="exportMaterials()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium">
                            <i class="fas fa-download mr-2"></i>Экспорт
                        </button>
                    </div>
                </div>
                
                <!-- Статистика материалов -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow-sm border">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="stats.total"></p>
                                <p class="text-sm text-gray-500">Всего материалов</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="stats.views.toLocaleString()"></p>
                                <p class="text-sm text-gray-500">Просмотров</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-yellow-100 text-yellow-600 mr-3">
                                <i class="fas fa-star"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="stats.avgRating"></p>
                                <p class="text-sm text-gray-500">Средний рейтинг</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-purple-100 text-purple-600 mr-3">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="stats.studentsUsing"></p>
                                <p class="text-sm text-gray-500">Студентов используют</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Фильтры и поиск -->
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="md:col-span-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" x-model="searchQuery" 
                                       placeholder="Поиск материалов..."
                                       class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            </div>
                        </div>
                        <select x-model="filterType" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            <option value="">Все типы</option>
                            <option value="article">Статья</option>
                            <option value="video">Видео</option>
                            <option value="presentation">Презентация</option>
                            <option value="exercise">Упражнение</option>
                            <option value="cheatsheet">Шпаргалка</option>
                        </select>
                        <select x-model="filterTrack" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            <option value="">Все треки</option>
                            <option value="frontend">Frontend</option>
                            <option value="backend">Backend</option>
                            <option value="data-science">Data Science</option>
                            <option value="devops">DevOps</option>
                        </select>
                        <select x-model="filterStatus" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            <option value="">Все статусы</option>
                            <option value="published">Опубликовано</option>
                            <option value="draft">Черновик</option>
                            <option value="archived">В архиве</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Переключение вида -->
            <div class="mb-6 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-gray-700">Вид:</span>
                    <button @click="viewMode = 'grid'" 
                            :class="viewMode === 'grid' ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'"
                            class="px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-th-large mr-2"></i>Сетка
                    </button>
                    <button @click="viewMode = 'list'" 
                            :class="viewMode === 'list' ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'"
                            class="px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-list mr-2"></i>Список
                    </button>
                    <button @click="viewMode = 'modules'" 
                            :class="viewMode === 'modules' ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'"
                            class="px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-sitemap mr-2"></i>Модули
                    </button>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600" x-text="`${filteredMaterials.length} материалов`"></span>
                    <button @click="toggleSortOrder()" class="text-sm text-gray-600 hover:text-gray-900">
                        <i class="fas" :class="sortOrder === 'desc' ? 'fa-sort-amount-down' : 'fa-sort-amount-up'"></i>
                        <span class="ml-2">Сортировка</span>
                    </button>
                </div>
            </div>

            <!-- Сетка материалов -->
            <div x-show="viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="material in filteredMaterials" :key="material.id">
                    <div class="material-card bg-white rounded-xl shadow-sm border overflow-hidden">
                        <!-- Заголовок и тип -->
                        <div class="p-5 border-b">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <span class="material-type-badge" :class="getTypeClass(material.type)" 
                                          x-text="getTypeName(material.type)"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs px-2 py-1 rounded-full" 
                                          :class="getStatusClass(material.status)"
                                          x-text="getStatusName(material.status)"></span>
                                    <button @click="showMaterialMenu(material)" class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <h3 class="font-bold text-gray-900 text-lg mb-2" x-text="material.title"></h3>
                            <p class="text-gray-600 text-sm" x-text="material.description"></p>
                        </div>
                        
                        <!-- Информация о материале -->
                        <div class="p-5">
                            <div class="space-y-3">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-clock mr-2"></i>
                                    <span>Время изучения: <span class="font-medium" x-text="material.duration"></span></span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-tag mr-2"></i>
                                    <span>Трек: <span class="font-medium" x-text="material.track"></span></span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-graduation-cap mr-2"></i>
                                    <span>Навыки: 
                                        <template x-for="skill in material.skills" :key="skill">
                                            <span class="ml-1 px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs" x-text="skill"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Статистика и рейтинг -->
                            <div class="mt-4 pt-4 border-t flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-eye mr-1"></i>
                                        <span x-text="material.views"></span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-heart mr-1 text-red-500"></i>
                                        <span x-text="material.likes"></span>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="flex">
                                        <template x-for="i in 5" :key="i">
                                            <i class="fas fa-star text-sm" :class="i <= material.rating ? 'text-yellow-400' : 'text-gray-300'"></i>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Действия -->
                        <div class="px-5 py-4 border-t bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <button @click="editMaterial(material)" 
                                        class="flex-1 px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition text-sm font-medium">
                                    Редактировать
                                </button>
                                <button @click="previewMaterial(material)" 
                                        class="flex-1 px-3 py-2 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition text-sm font-medium">
                                    Просмотр
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Список материалов -->
            <div x-show="viewMode === 'list'" class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Материал
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Тип
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Трек
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Статус
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Просмотры
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Рейтинг
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Действия
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="material in filteredMaterials" :key="material.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10 rounded-lg flex items-center justify-center mr-3"
                                                 :class="getTypeIconBg(material.type)">
                                                <i class="fas" :class="getTypeIcon(material.type)"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-gray-900" x-text="material.title"></div>
                                                <div class="text-sm text-gray-500 truncate max-w-xs" x-text="material.description"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="material-type-badge" :class="getTypeClass(material.type)" 
                                              x-text="getTypeName(material.type)"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800" 
                                              x-text="material.track"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs rounded-full" 
                                              :class="getStatusClass(material.status)"
                                              x-text="getStatusName(material.status)"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="material.views"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="flex">
                                                <template x-for="i in 5" :key="i">
                                                    <i class="fas fa-star text-xs" :class="i <= material.rating ? 'text-yellow-400' : 'text-gray-300'"></i>
                                                </template>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600" x-text="material.rating"></span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex items-center space-x-3">
                                            <button @click="previewMaterial(material)" class="text-teacher hover:text-teacher/80">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button @click="editMaterial(material)" class="text-blue-600 hover:text-blue-800">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="duplicateMaterial(material)" class="text-green-600 hover:text-green-800">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button @click="deleteMaterial(material)" class="text-red-600 hover:text-red-800">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Представление модулей -->
            <div x-show="viewMode === 'modules'" class="space-y-6">
                <template x-for="module in modules" :key="module.id">
                    <div class="bg-white rounded-xl shadow-sm border">
                        <!-- Заголовок модуля -->
                        <div class="p-5 border-b flex items-center justify-between">
                            <div>
                                <h3 class="font-bold text-gray-900 text-lg" x-text="module.title"></h3>
                                <p class="text-gray-600 text-sm" x-text="module.description"></p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button @click="editModule(module)" class="text-sm teacher-text hover:underline">
                                    Редактировать модуль
                                </button>
                                <button @click="addMaterialToModule(module)" class="px-3 py-1 teacher-bg text-white rounded-lg text-sm">
                                    + Материал
                                </button>
                            </div>
                        </div>
                        
                        <!-- Материалы модуля -->
                        <div class="p-5">
                            <div x-ref="module-${module.id}" class="space-y-3">
                                <template x-for="material in module.materials" :key="material.id">
                                    <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 drag-handle">
                                        <div class="flex-shrink-0 mr-4 text-gray-400">
                                            <i class="fas fa-grip-vertical"></i>
                                        </div>
                                        <div class="flex-shrink-0 mr-4">
                                            <div class="h-10 w-10 rounded-lg flex items-center justify-center"
                                                 :class="getTypeIconBg(material.type)">
                                                <i class="fas" :class="getTypeIcon(material.type)"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-gray-900" x-text="material.title"></h4>
                                            <p class="text-sm text-gray-500" x-text="material.description"></p>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <span class="material-type-badge" :class="getTypeClass(material.type)" 
                                                  x-text="getTypeName(material.type)"></span>
                                            <span class="text-sm text-gray-500" x-text="material.duration"></span>
                                            <div class="flex items-center space-x-2">
                                                <button @click="editMaterial(material)" class="text-gray-400 hover:text-gray-600">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="removeMaterialFromModule(module, material)" class="text-gray-400 hover:text-red-600">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            
                            <!-- Пустой модуль -->
                            <div x-show="module.materials.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-folder-open text-3xl mb-3"></i>
                                <p>В этом модуле пока нет материалов</p>
                                <button @click="addMaterialToModule(module)" class="mt-3 text-teacher hover:underline">
                                    Добавить первый материал
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
                
                <!-- Добавление нового модуля -->
                <div class="text-center">
                    <button @click="showCreateModuleModal = true" 
                            class="px-4 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-teacher hover:bg-teacher/5 transition w-full">
                        <i class="fas fa-plus mr-2"></i>Создать новый модуль
                    </button>
                </div>
            </div>

            <!-- Пагинация (для сетки и списка) -->
            <div x-show="viewMode !== 'modules'" class="mt-6 flex items-center justify-between">
                <div class="text-sm text-gray-500">
                    Показано <span x-text="filteredMaterials.length"></span> из <span x-text="materials.length"></span> материалов
                </div>
                <div class="flex items-center space-x-2">
                    <button @click="prevPage()" :disabled="currentPage === 1" 
                            class="p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="text-sm text-gray-600">Страница <span x-text="currentPage"></span></span>
                    <button @click="nextPage()" :disabled="currentPage * itemsPerPage >= filteredMaterials.length" 
                            class="p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Модальное окно создания/редактирования материала -->
    <div x-show="showCreateModal || editingMaterial" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 overflow-y-auto">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900" x-text="editingMaterial ? 'Редактирование материала' : 'Создание нового материала'"></h2>
                    <button @click="closeMaterialModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Шаги создания -->
                <div class="mb-8">
                    <div class="flex items-center justify-center">
                        <div class="flex items-center">
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium"
                                     :class="createStep >= 1 ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'">
                                    1
                                </div>
                                <span class="text-xs mt-2 text-gray-700">Основное</span>
                            </div>
                            <div class="w-16 h-1 mx-2" :class="createStep > 1 ? 'teacher-bg' : 'bg-gray-300'"></div>
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium"
                                     :class="createStep >= 2 ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'">
                                    2
                                </div>
                                <span class="text-xs mt-2 text-gray-700">Контент</span>
                            </div>
                            <div class="w-16 h-1 mx-2" :class="createStep > 2 ? 'teacher-bg' : 'bg-gray-300'"></div>
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium"
                                     :class="createStep >= 3 ? 'teacher-bg text-white' : 'bg-gray-200 text-gray-700'">
                                    3
                                </div>
                                <span class="text-xs mt-2 text-gray-700">Настройки</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Шаг 1: Основная информация -->
                <div x-show="createStep === 1">
                    <form @submit.prevent="nextStep()" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Название материала *</label>
                            <input type="text" x-model="newMaterial.title" required
                                   class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                   placeholder="Например: Введение в React Hooks">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Описание *</label>
                            <textarea x-model="newMaterial.description" rows="3" required
                                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                      placeholder="Краткое описание материала..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Тип материала *</label>
                                <select x-model="newMaterial.type" required
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="article">Статья</option>
                                    <option value="video">Видеоурок</option>
                                    <option value="presentation">Презентация</option>
                                    <option value="exercise">Практическое упражнение</option>
                                    <option value="cheatsheet">Шпаргалка</option>
                                    <option value="quiz">Тест/Квиз</option>
                                    <option value="project">Проектное задание</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Трек обучения *</label>
                                <select x-model="newMaterial.track" required
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="frontend">Frontend-разработка</option>
                                    <option value="backend">Backend-разработка</option>
                                    <option value="data-science">Data Science</option>
                                    <option value="devops">DevOps</option>
                                    <option value="design">UX/UI дизайн</option>
                                    <option value="mobile">Мобильная разработка</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Уровень сложности *</label>
                                <select x-model="newMaterial.difficulty" required
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="beginner">Начальный</option>
                                    <option value="intermediate">Средний</option>
                                    <option value="advanced">Продвинутый</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Время изучения *</label>
                                <input type="text" x-model="newMaterial.duration" required
                                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                       placeholder="Например: 30 минут">
                            </div>
                        </div>
                        
                        <div class="pt-6 border-t">
                            <div class="flex justify-end">
                                <button type="submit" 
                                        class="px-6 py-3 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                                    Далее: Контент
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Шаг 2: Содержание материала -->
                <div x-show="createStep === 2">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Содержание материала *</label>
                            <div x-ref="editor" class="border rounded-lg"></div>
                        </div>
                        
                        <div x-show="newMaterial.type === 'video'">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ссылка на видео (YouTube/Vimeo)</label>
                            <input type="url" x-model="newMaterial.videoUrl"
                                   class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                   placeholder="https://youtube.com/watch?v=...">
                        </div>
                        
                        <div x-show="['presentation', 'cheatsheet'].includes(newMaterial.type)">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Загрузить файл</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                                <p class="text-gray-600 mb-2">Перетащите файл сюда или</p>
                                <input type="file" id="materialFile" class="hidden" @change="handleFileUpload">
                                <label for="materialFile" class="px-4 py-2 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition cursor-pointer">
                                    Выберите файл
                                </label>
                                <p class="text-xs text-gray-500 mt-3">PDF, PPT, DOCX до 50MB</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Дополнительные ресурсы</label>
                            <div class="space-y-2">
                                <template x-for="(resource, index) in newMaterial.resources" :key="index">
                                    <div class="flex items-center space-x-2">
                                        <input type="url" x-model="resource.url"
                                               class="flex-1 px-4 py-2 border rounded-lg"
                                               placeholder="Ссылка на ресурс">
                                        <input type="text" x-model="resource.title"
                                               class="flex-1 px-4 py-2 border rounded-lg"
                                               placeholder="Название ресурса">
                                        <button @click="removeResource(index)" class="text-red-500 hover:text-red-700">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </template>
                                <button @click="addResource()" class="text-sm teacher-text hover:underline">
                                    <i class="fas fa-plus mr-1"></i>Добавить ресурс
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-6 border-t mt-6">
                        <div class="flex justify-between">
                            <button @click="createStep = 1" 
                                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium">
                                Назад
                            </button>
                            <button @click="nextStep()" 
                                    class="px-6 py-3 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                                Далее: Настройки
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Шаг 3: Настройки и публикация -->
                <div x-show="createStep === 3">
                    <div class="space-y-6">
                        <!-- Навыки -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Связанные навыки</label>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <template x-for="skill in newMaterial.skills" :key="skill">
                                    <span class="px-3 py-1 bg-teacher/10 text-teacher rounded-full text-sm flex items-center">
                                        <span x-text="skill"></span>
                                        <button @click="removeSkill(skill)" class="ml-2 hover:text-teacher/70">
                                            <i class="fas fa-times text-xs"></i>
                                        </button>
                                    </span>
                                </template>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="text" x-model="skillInput" @keydown.enter.prevent="addSkill()"
                                       class="flex-1 px-4 py-2 border rounded-lg"
                                       placeholder="Введите навык и нажмите Enter">
                                <button @click="addSkill()" class="px-4 py-2 teacher-bg text-white rounded-lg">
                                    Добавить
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Пример: React Hooks, useState, useEffect, JavaScript</p>
                        </div>
                        
                        <!-- Теги -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Теги</label>
                            <input type="text" x-model="newMaterial.tags"
                                   class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                   placeholder="react, hooks, javascript (через запятую)">
                        </div>
                        
                        <!-- Настройки публикации -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Статус</label>
                                <select x-model="newMaterial.status"
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="draft">Черновик</option>
                                    <option value="published">Опубликовать сразу</option>
                                    <option value="scheduled">Запланировать публикацию</option>
                                </select>
                            </div>
                            
                            <div x-show="newMaterial.status === 'scheduled'">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Дата публикации</label>
                                <input type="datetime-local" x-model="newMaterial.publishDate"
                                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Доступ</label>
                                <select x-model="newMaterial.access"
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="public">Для всех студентов</option>
                                    <option value="restricted">Только для моих студентов</option>
                                    <option value="private">Только для меня (черновик)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Модуль (опционально)</label>
                                <select x-model="newMaterial.moduleId"
                                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                                    <option value="">Без модуля</option>
                                    <template x-for="module in modules" :key="module.id">
                                        <option :value="module.id" x-text="module.title"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Дополнительные настройки -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-gray-900 mb-3">Дополнительные настройки</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newMaterial.allowComments" class="mr-2">
                                    <span class="text-sm text-gray-700">Разрешить комментарии</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newMaterial.allowDownloads" class="mr-2">
                                    <span class="text-sm text-gray-700">Разрешить скачивание</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newMaterial.hasQuiz" class="mr-2">
                                    <span class="text-sm text-gray-700">Добавить тест в конце</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newMaterial.certificate" class="mr-2">
                                    <span class="text-sm text-gray-700">Выдавать сертификат</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-6 border-t mt-6">
                        <div class="flex justify-between">
                            <button @click="createStep = 2" 
                                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium">
                                Назад
                            </button>
                            <div class="space-x-3">
                                <button @click="saveAsDraft()" 
                                        class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium">
                                    Сохранить черновик
                                </button>
                                <button @click="saveMaterial()" 
                                        class="px-6 py-3 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                                    <span x-text="editingMaterial ? 'Сохранить изменения' : 'Опубликовать материал'"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно предпросмотра -->
    <div x-show="previewMaterialData" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 overflow-y-auto">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <span class="material-type-badge" :class="getTypeClass(previewMaterialData.type)" 
                              x-text="getTypeName(previewMaterialData.type)"></span>
                        <h2 class="text-2xl font-bold text-gray-900 mt-2" x-text="previewMaterialData.title"></h2>
                    </div>
                    <button @click="previewMaterialData = null" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="prose max-w-none">
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Трек</p>
                                <p class="font-medium" x-text="previewMaterialData.track"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Уровень</p>
                                <p class="font-medium" x-text="previewMaterialData.difficulty"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Время</p>
                                <p class="font-medium" x-text="previewMaterialData.duration"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Автор</p>
                                <p class="font-medium" x-text="user.name"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Описание</h3>
                        <p x-text="previewMaterialData.description"></p>
                    </div>
                    
                    <div x-show="previewMaterialData.skills && previewMaterialData.skills.length > 0" class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Навыки, которые вы освоите</h3>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="skill in previewMaterialData.skills" :key="skill">
                                <span class="px-3 py-1 bg-teacher/10 text-teacher rounded-full text-sm" x-text="skill"></span>
                            </template>
                        </div>
                    </div>
                    
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-semibold mb-4">Содержание</h3>
                        <div x-html="previewMaterialData.content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно создания модуля -->
    <div x-show="showCreateModuleModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50">
        <div class="bg-white rounded-2xl max-w-md w-full">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900">Создание нового модуля</h2>
                    <button @click="showCreateModuleModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form @submit.prevent="createModule()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Название модуля *</label>
                        <input type="text" x-model="newModule.title" required
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                               placeholder="Например: Основы React">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Описание</label>
                        <textarea x-model="newModule.description" rows="3"
                                  class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher"
                                  placeholder="Краткое описание модуля..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Трек</label>
                        <select x-model="newModule.track" 
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teacher">
                            <option value="frontend">Frontend-разработка</option>
                            <option value="backend">Backend-разработка</option>
                            <option value="data-science">Data Science</option>
                            <option value="devops">DevOps</option>
                        </select>
                    </div>
                    
                    <div class="pt-4 flex items-center space-x-4">
                        <button type="submit" 
                                class="flex-1 px-6 py-3 teacher-bg text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                            Создать модуль
                        </button>
                        <button type="button" @click="showCreateModuleModal = false"
                                class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function materialsPage() {
            return {
                user: {
                    name: 'Алексей Иванов',
                    email: 'alexey@example.com'
                },
                viewMode: 'grid',
                searchQuery: '',
                filterType: '',
                filterTrack: '',
                filterStatus: '',
                sortOrder: 'desc',
                currentPage: 1,
                itemsPerPage: 12,
                showCreateModal: false,
                showCreateModuleModal: false,
                editingMaterial: null,
                previewMaterialData: null,
                createStep: 1,
                skillInput: '',
                editor: null,
                
                stats: {
                    total: 47,
                    views: 12560,
                    avgRating: 4.7,
                    studentsUsing: 142
                },
                
                newMaterial: {
                    title: '',
                    description: '',
                    type: 'article',
                    track: 'frontend',
                    difficulty: 'beginner',
                    duration: '',
                    content: '',
                    videoUrl: '',
                    resources: [],
                    skills: [],
                    tags: '',
                    status: 'draft',
                    publishDate: '',
                    access: 'public',
                    moduleId: '',
                    allowComments: true,
                    allowDownloads: true,
                    hasQuiz: false,
                    certificate: false,
                    file: null
                },
                
                newModule: {
                    title: '',
                    description: '',
                    track: 'frontend'
                },
                
                materials: [
                    {
                        id: 'MAT001',
                        title: 'Введение в React Hooks',
                        description: 'Изучите основные хуки React: useState, useEffect, useContext',
                        type: 'article',
                        track: 'frontend',
                        difficulty: 'beginner',
                        duration: '45 минут',
                        content: '<h2>Что такое React Hooks?</h2><p>React Hooks - это функции, которые позволяют использовать состояние и другие возможности React без написания классов...</p>',
                        views: 1245,
                        likes: 89,
                        rating: 4.8,
                        status: 'published',
                        skills: ['React', 'Hooks', 'useState', 'useEffect'],
                        createdAt: '2024-01-15',
                        updatedAt: '2024-01-20'
                    },
                    {
                        id: 'MAT002',
                        title: 'Python для анализа данных',
                        description: 'Основы работы с Pandas и NumPy для анализа данных',
                        type: 'video',
                        track: 'data-science',
                        difficulty: 'beginner',
                        duration: '60 минут',
                        content: '',
                        videoUrl: 'https://youtube.com/watch?v=example',
                        views: 892,
                        likes: 45,
                        rating: 4.5,
                        status: 'published',
                        skills: ['Python', 'Pandas', 'NumPy', 'Data Analysis'],
                        createdAt: '2024-01-10',
                        updatedAt: '2024-01-15'
                    },
                    {
                        id: 'MAT003',
                        title: 'Основы Docker',
                        description: 'Создание и управление контейнерами Docker',
                        type: 'presentation',
                        track: 'devops',
                        difficulty: 'intermediate',
                        duration: '30 минут',
                        content: '',
                        views: 567,
                        likes: 32,
                        rating: 4.6,
                        status: 'published',
                        skills: ['Docker', 'Containers', 'DevOps'],
                        createdAt: '2024-01-05',
                        updatedAt: '2024-01-12'
                    },
                    {
                        id: 'MAT004',
                        title: 'Практика: Создание Todo App',
                        description: 'Практическое упражнение по созданию приложения на React',
                        type: 'exercise',
                        track: 'frontend',
                        difficulty: 'beginner',
                        duration: '90 минут',
                        content: '<h2>Задание</h2><p>Создайте приложение для управления задачами...</p>',
                        views: 432,
                        likes: 28,
                        rating: 4.3,
                        status: 'published',
                        skills: ['React', 'JavaScript', 'CSS', 'Local Storage'],
                        createdAt: '2024-01-08',
                        updatedAt: '2024-01-10'
                    },
                    {
                        id: 'MAT005',
                        title: 'Шпаргалка по Git',
                        description: 'Основные команды Git для ежедневной работы',
                        type: 'cheatsheet',
                        track: 'devops',
                        difficulty: 'beginner',
                        duration: '15 минут',
                        content: '',
                        views: 1123,
                        likes: 67,
                        rating: 4.9,
                        status: 'published',
                        skills: ['Git', 'Version Control'],
                        createdAt: '2024-01-03',
                        updatedAt: '2024-01-05'
                    }
                ],
                
                modules: [
                    {
                        id: 'MOD001',
                        title: 'Основы Frontend разработки',
                        description: 'Введение в веб-разработку и современные технологии',
                        track: 'frontend',
                        order: 1,
                        materials: ['MAT001', 'MAT004']
                    },
                    {
                        id: 'MOD002',
                        title: 'DevOps и инфраструктура',
                        description: 'Основы работы с контейнерами и CI/CD',
                        track: 'devops',
                        order: 2,
                        materials: ['MAT003', 'MAT005']
                    }
                ],
                
                init() {
                    // Проверка авторизации и роли
                    const session = localStorage.getItem('userSession');
                    if (!session) {
                        window.location.href = '../index.html';
                        return;
                    }
                    
                    const userData = JSON.parse(session);
                    if (userData.role !== 'teacher') {
                        window.location.href = userData.role === 'admin' ? '../admin/dashboard.html' : '../student/dashboard.html';
                        return;
                    }
                    
                    this.user.email = userData.email;
                    this.user.name = userData.name || 'Преподаватель';
                    
                    // Загрузка материалов из localStorage
                    const savedMaterials = localStorage.getItem('teacherMaterials');
                    if (savedMaterials) {
                        const parsed = JSON.parse(savedMaterials);
                        if (parsed.length > 0) {
                            this.materials = parsed;
                            this.updateStats();
                        }
                    }
                    
                    // Загрузка модулей из localStorage
                    const savedModules = localStorage.getItem('teacherModules');
                    if (savedModules) {
                        this.modules = JSON.parse(savedModules);
                    }
                    
                    // Инициализация материалов для модулей
                    this.initModuleMaterials();
                },
                
                initModuleMaterials() {
                    // Заполняем материалы в модулях
                    this.modules.forEach(module => {
                        module.materials = module.materials
                            .map(materialId => this.materials.find(m => m.id === materialId))
                            .filter(Boolean);
                    });
                },
                
                get filteredMaterials() {
                    let filtered = this.materials;
                    
                    // Фильтрация по поисковому запросу
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(material => 
                            material.title.toLowerCase().includes(query) ||
                            material.description.toLowerCase().includes(query) ||
                            material.skills.some(skill => skill.toLowerCase().includes(query))
                        );
                    }
                    
                    // Фильтрация по типу
                    if (this.filterType) {
                        filtered = filtered.filter(material => material.type === this.filterType);
                    }
                    
                    // Фильтрация по треку
                    if (this.filterTrack) {
                        filtered = filtered.filter(material => material.track === this.filterTrack);
                    }
                    
                    // Фильтрация по статусу
                    if (this.filterStatus) {
                        filtered = filtered.filter(material => material.status === this.filterStatus);
                    }
                    
                    // Сортировка
                    filtered.sort((a, b) => {
                        if (this.sortOrder === 'desc') {
                            return new Date(b.createdAt) - new Date(a.createdAt);
                        } else {
                            return new Date(a.createdAt) - new Date(b.createdAt);
                        }
                    });
                    
                    return filtered;
                },
                
                getTypeName(type) {
                    const types = {
                        'article': 'Статья',
                        'video': 'Видео',
                        'presentation': 'Презентация',
                        'exercise': 'Упражнение',
                        'cheatsheet': 'Шпаргалка',
                        'quiz': 'Тест',
                        'project': 'Проект'
                    };
                    return types[type] || type;
                },
                
                getTypeClass(type) {
                    const classes = {
                        'article': 'material-type-article',
                        'video': 'material-type-video',
                        'presentation': 'material-type-presentation',
                        'exercise': 'material-type-exercise',
                        'cheatsheet': 'material-type-cheatsheet',
                        'quiz': 'material-type-article',
                        'project': 'material-type-exercise'
                    };
                    return classes[type] || 'material-type-article';
                },
                
                getTypeIcon(type) {
                    const icons = {
                        'article': 'fa-file-alt',
                        'video': 'fa-video',
                        'presentation': 'fa-tv',
                        'exercise': 'fa-code',
                        'cheatsheet': 'fa-clipboard-list',
                        'quiz': 'fa-question-circle',
                        'project': 'fa-project-diagram'
                    };
                    return icons[type] || 'fa-file-alt';
                },
                
                getTypeIconBg(type) {
                    const backgrounds = {
                        'article': 'bg-blue-100 text-blue-600',
                        'video': 'bg-red-100 text-red-600',
                        'presentation': 'bg-yellow-100 text-yellow-600',
                        'exercise': 'bg-green-100 text-green-600',
                        'cheatsheet': 'bg-indigo-100 text-indigo-600',
                        'quiz': 'bg-purple-100 text-purple-600',
                        'project': 'bg-pink-100 text-pink-600'
                    };
                    return backgrounds[type] || 'bg-blue-100 text-blue-600';
                },
                
                getStatusName(status) {
                    const statuses = {
                        'published': 'Опубликовано',
                        'draft': 'Черновик',
                        'archived': 'Архив',
                        'scheduled': 'Запланировано'
                    };
                    return statuses[status] || status;
                },
                
                getStatusClass(status) {
                    const classes = {
                        'published': 'bg-green-100 text-green-800',
                        'draft': 'bg-yellow-100 text-yellow-800',
                        'archived': 'bg-gray-100 text-gray-800',
                        'scheduled': 'bg-blue-100 text-blue-800'
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                
                updateStats() {
                    this.stats.total = this.materials.length;
                    this.stats.views = this.materials.reduce((sum, m) => sum + m.views, 0);
                    
                    if (this.materials.length > 0) {
                        const totalRating = this.materials.reduce((sum, m) => sum + m.rating, 0);
                        this.stats.avgRating = (totalRating / this.materials.length).toFixed(1);
                    }
                },
                
                toggleSortOrder() {
                    this.sortOrder = this.sortOrder === 'desc' ? 'asc' : 'desc';
                },
                
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                    }
                },
                
                nextPage() {
                    if (this.currentPage * this.itemsPerPage < this.filteredMaterials.length) {
                        this.currentPage++;
                    }
                },
                
                showMaterialMenu(material) {
                    // В реальном приложении здесь было бы выпадающее меню
                    const action = prompt(`Действия для "${material.title}":\n1 - Редактировать\n2 - Дублировать\n3 - Архивировать\n4 - Удалить`);
                    
                    switch(action) {
                        case '1':
                            this.editMaterial(material);
                            break;
                        case '2':
                            this.duplicateMaterial(material);
                            break;
                        case '3':
                            this.archiveMaterial(material);
                            break;
                        case '4':
                            this.deleteMaterial(material);
                            break;
                    }
                },
                
                editMaterial(material) {
                    this.editingMaterial = { ...material };
                    this.newMaterial = { ...material };
                    
                    // Инициализация редактора при следующем обновлении DOM
                    this.$nextTick(() => {
                        if (!this.editor) {
                            this.editor = new Quill(this.$refs.editor, {
                                theme: 'snow',
                                modules: {
                                    toolbar: [
                                        ['bold', 'italic', 'underline', 'strike'],
                                        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                        ['link', 'image', 'code-block'],
                                        ['clean']
                                    ]
                                }
                            });
                            
                            this.editor.root.innerHTML = this.newMaterial.content || '';
                        }
                    });
                    
                    this.showCreateModal = true;
                    this.createStep = 1;
                },
                
                previewMaterial(material) {
                    this.previewMaterialData = { ...material };
                },
                
                duplicateMaterial(material) {
                    const newMaterial = {
                        ...material,
                        id: 'MAT' + (this.materials.length + 1).toString().padStart(3, '0'),
                        title: material.title + ' (Копия)',
                        status: 'draft',
                        views: 0,
                        likes: 0,
                        createdAt: new Date().toISOString().split('T')[0],
                        updatedAt: new Date().toISOString().split('T')[0]
                    };
                    
                    this.materials.push(newMaterial);
                    this.saveMaterials();
                    this.updateStats();
                    alert('Материал успешно дублирован');
                },
                
                archiveMaterial(material) {
                    material.status = 'archived';
                    this.saveMaterials();
                    alert('Материал перемещен в архив');
                },
                
                deleteMaterial(material) {
                    if (confirm(`Удалить материал "${material.title}"? Это действие нельзя отменить.`)) {
                        // Удаляем из основного списка
                        this.materials = this.materials.filter(m => m.id !== material.id);
                        
                        // Удаляем из модулей
                        this.modules.forEach(module => {
                            module.materials = module.materials.filter(m => m.id !== material.id);
                        });
                        
                        this.saveMaterials();
                        this.saveModules();
                        this.updateStats();
                        alert('Материал удален');
                    }
                },
                
                nextStep() {
                    if (this.createStep === 2 && this.editor) {
                        this.newMaterial.content = this.editor.root.innerHTML;
                    }
                    
                    if (this.createStep < 3) {
                        this.createStep++;
                    }
                },
                
                addResource() {
                    this.newMaterial.resources.push({ url: '', title: '' });
                },
                
                removeResource(index) {
                    this.newMaterial.resources.splice(index, 1);
                },
                
                addSkill() {
                    if (this.skillInput.trim() && !this.newMaterial.skills.includes(this.skillInput.trim())) {
                        this.newMaterial.skills.push(this.skillInput.trim());
                        this.skillInput = '';
                    }
                },
                
                removeSkill(skill) {
                    this.newMaterial.skills = this.newMaterial.skills.filter(s => s !== skill);
                },
                
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.newMaterial.file = file;
                        alert(`Файл "${file.name}" загружен`);
                    }
                },
                
                saveAsDraft() {
                    this.newMaterial.status = 'draft';
                    this.saveMaterial();
                },
                
                saveMaterial() {
                    if (!this.newMaterial.title.trim()) {
                        alert('Введите название материала');
                        return;
                    }
                    
                    // Получаем контент из редактора
                    if (this.editor) {
                        this.newMaterial.content = this.editor.root.innerHTML;
                    }
                    
                    if (this.editingMaterial) {
                        // Редактирование существующего материала
                        const index = this.materials.findIndex(m => m.id === this.editingMaterial.id);
                        if (index !== -1) {
                            this.materials[index] = {
                                ...this.newMaterial,
                                id: this.editingMaterial.id,
                                updatedAt: new Date().toISOString().split('T')[0]
                            };
                        }
                    } else {
                        // Создание нового материала
                        const newId = 'MAT' + (this.materials.length + 1).toString().padStart(3, '0');
                        const newMaterial = {
                            ...this.newMaterial,
                            id: newId,
                            views: 0,
                            likes: 0,
                            rating: 0,
                            createdAt: new Date().toISOString().split('T')[0],
                            updatedAt: new Date().toISOString().split('T')[0]
                        };
                        
                        this.materials.push(newMaterial);
                        
                        // Добавляем в модуль, если выбран
                        if (this.newMaterial.moduleId) {
                            const module = this.modules.find(m => m.id === this.newMaterial.moduleId);
                            if (module && !module.materials.some(m => m.id === newId)) {
                                module.materials.push(newMaterial);
                                this.saveModules();
                            }
                        }
                    }
                    
                    this.saveMaterials();
                    this.updateStats();
                    this.closeMaterialModal();
                    
                    if (this.newMaterial.status === 'published') {
                        alert('Материал успешно опубликован!');
                    } else {
                        alert('Материал сохранен как черновик');
                    }
                },
                
                closeMaterialModal() {
                    this.showCreateModal = false;
                    this.editingMaterial = null;
                    this.newMaterial = {
                        title: '',
                        description: '',
                        type: 'article',
                        track: 'frontend',
                        difficulty: 'beginner',
                        duration: '',
                        content: '',
                        videoUrl: '',
                        resources: [],
                        skills: [],
                        tags: '',
                        status: 'draft',
                        publishDate: '',
                        access: 'public',
                        moduleId: '',
                        allowComments: true,
                        allowDownloads: true,
                        hasQuiz: false,
                        certificate: false,
                        file: null
                    };
                    this.createStep = 1;
                },
                
                createModule() {
                    if (!this.newModule.title.trim()) {
                        alert('Введите название модуля');
                        return;
                    }
                    
                    const newId = 'MOD' + (this.modules.length + 1).toString().padStart(3, '0');
                    const newModule = {
                        ...this.newModule,
                        id: newId,
                        order: this.modules.length + 1,
                        materials: []
                    };
                    
                    this.modules.push(newModule);
                    this.saveModules();
                    this.showCreateModuleModal = false;
                    
                    // Сброс формы
                    this.newModule = {
                        title: '',
                        description: '',
                        track: 'frontend'
                    };
                    
                    alert('Модуль успешно создан');
                },
                
                editModule(module) {
                    const newTitle = prompt('Введите новое название модуля:', module.title);
                    if (newTitle && newTitle.trim() !== module.title) {
                        module.title = newTitle.trim();
                        this.saveModules();
                        alert('Название модуля обновлено');
                    }
                },
                
                addMaterialToModule(module) {
                    this.showCreateModal = true;
                    this.newMaterial.moduleId = module.id;
                },
                
                removeMaterialFromModule(module, material) {
                    module.materials = module.materials.filter(m => m.id !== material.id);
                    this.saveModules();
                },
                
                exportMaterials() {
                    const data = JSON.stringify(this.materials, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'materials_export.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    alert('Материалы экспортированы в JSON файл');
                },
                
                saveMaterials() {
                    localStorage.setItem('teacherMaterials', JSON.stringify(this.materials));
                },
                
                saveModules() {
                    localStorage.setItem('teacherModules', JSON.stringify(this.modules));
                },
                
                logout() {
                    localStorage.removeItem('userSession');
                    window.location.href = '../index.html';
                }
            }
        }
    </script>
</body>
</html>